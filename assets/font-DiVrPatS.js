async function W(i,e,t){try{const s=await fetch(i);if(!s.ok)return;const n=await s.json();e(n),t?.()}catch(s){console.error(s)}}async function V(i,e,t){try{const s=await fetch(i);if(!s.ok)return;const n=await s.json();e(n),t?.()}catch(s){console.error(s)}}const H=[];async function qe(i){await W(i,Q)}function Q(i){const e=[];Object.entries(i).forEach(([t,s])=>{const n=K(t,s);e.push(n),H.push(t)}),Z(e.join(`
`))}function K(i,e){const t=[`@keyframes ${i} {`];for(const[s,n]of Object.entries(e)){const a=Object.entries(n).map(([o,r])=>`    ${o}: ${r};`).join(" ");t.push(`  ${s} { ${a} }`)}return t.push("}"),t.join(`
`)}function Z(i){let e=document.querySelector("#dynamic-animation-styles");e||(e=document.createElement("style"),e.id="dynamic-animation-styles",document.head.appendChild(e)),e.textContent=i+`
`}function Fe(){return H}function X(i,e){!i||!e||(i.style.animationName=e.reference,i.style.animationDuration=`${e.duration}ms`,i.style.animationTimingFunction=e.timing,i.style.animationIterationCount=e.iterations.toString(),i.offsetWidth)}function j(i){i&&(i.style.animationName="",i.style.animationDuration="",i.style.animationTimingFunction="",i.style.animationIterationCount="",i.offsetWidth)}var N=(i=>(i[i.LOW=0]="LOW",i[i.CRITICAL=1]="CRITICAL",i))(N||{});class Y extends EventTarget{data={0:[],1:[]};locked=!1;push(e,t){this.data[t].push(e),this.dispatchEvent(new Event("element-pushed"))}pop(){return this.data[1].length>0?this.data[1].shift():this.locked?null:this.data[0].shift()}lock(){this.locked=!0}unlock(){this.locked=!1}isEmpty(){return Object.values(this.data).every(e=>e.length===0)}}class ee{timeout;cancel(){clearTimeout(this.timeout)}}class We{queue=new Y;displayContainer;isAnimating=!1;currentAnimatingItem=null;constructor(e){this.displayContainer=e,this.queue.addEventListener("element-pushed",async()=>{await this.processQueue()})}push(e,t){const s=t?N.CRITICAL:N.LOW;this.queue.push(e,s)}async processQueue(){this.isAnimating||(this.isAnimating=!0,this.displayContainer.style.display="",await this.displayItem(),this.isAnimating=!1)}async displayItem(){for(;!this.queue.isEmpty();){const e=this.queue.pop();e&&(this.currentAnimatingItem=e,this.displayContainer.style.visibility="",await e.display(this.displayContainer),this.displayContainer.style.visibility="hidden")}}cancel(){this.currentAnimatingItem&&(this.currentAnimatingItem.cancel(),this.currentAnimatingItem=null,this.displayContainer.style.visibility="hidden",this.displayItem())}lockQueue(){this.queue.lock()}unlockQueue(){this.queue.unlock()}}const R=new Map,I=new Map;async function He(i){await V(i,te),console.log("MEDIA",R,I)}function te(i){D(R,i.images),D(I,i.audios)}function D(i,e){Object.entries(e).forEach(([t,s])=>{i.set(t,s)})}function Ge(){return Array.from(R.keys())}function Be(){return Array.from(I.keys())}function se(i){return I.get(i)}function ie(i){return R.get(i)}const ne="en";let E="en";function Je(){E=new URL(window.location.href).searchParams.get("lang")||ne,console.log("LANGUAGE",E)}function ae(i,e,t){if(!t)return"";const s=t[E];return s?i?s.replace(/{{(\w+)}}/g,(a,o)=>{if(!(o in i))return console.error(`{{${o}}} is not defined in "${s}"`),"";const r=i[o]??"";return`<span class="variable ${o} ${e}-${o}">${r}</span>`}):s:""}function O(i){if(i.length!==0)return i[Math.floor(Math.random()*i.length)]}class p extends ee{slot;config;variables;resolveDisplay;constructor(e,t,s){super(),this.slot=e,this.config=t,this.variables=s}cancel(){super.cancel();const e=document.querySelector(".alert-audio");e&&(e.pause(),e.currentTime=0,e.removeAttribute("src"));const t=document.querySelector(".alert-container");t&&(j(t),this.removeImage(t),this.removeText(t)),this.resolveDisplay&&this.resolveDisplay()}async display(e){return new Promise(t=>{this.resolveDisplay=t,this.setAudio(e),this.setText(e),this.setImage(e),this.setAnimation(e),this.timeout=setTimeout(()=>{j(e),this.removeText(e),this.removeImage(e),this.resolveDisplay=void 0,t()},this.config.timeout)})}setText(e){const t=e.querySelector(".alert-text");if(!t)return;const s=ae(this.variables,this.config.name,this.config.translations);s!==null&&(t.innerHTML=s,t.classList.add(this.config.name))}removeText(e){const t=e.querySelector(".alert-text");t&&(t.innerHTML="",t.className="alert-text")}setImage(e){const t=e.querySelector(".alert-image");if(this.config.imageReferences&&t){const s=O(this.config.imageReferences),n=ie(s);n===""||n===void 0?(t.removeAttribute("src"),t.style.visibility="hidden"):(t.src=n,t.style.visibility="")}}removeImage(e){const t=e.querySelector(".alert-image");t&&(t.src="",t.removeAttribute("src"))}setAudio(e){const t=e.querySelector(".alert-audio");if(this.config.audioReferences.length>0&&t){const s=O(this.config.audioReferences),n=se(s);n===""||n===void 0?(t.pause(),t.removeAttribute("src")):(t.src=n,t.play())}}setAnimation(e){this.config.animation&&X(e,{...this.config.animation,duration:this.config.animation.duration||this.config.timeout})}}class Ve extends p{constructor(e,t){super(e,t,{slot:e})}}class Qe extends p{constructor(e,t){super(e,t,{slot:e})}}class Ke extends p{constructor(e,t){super(e,t,{slot:e})}}class Ze extends p{constructor(e,t,s,n){super(e,t,{slot:e,sender:n,item:s})}}class Xe extends p{constructor(e,t,s,n){super(e,t,{slot:e,sender:s,reason:n})}}class Ye extends p{constructor(e,t,s,n){super(e,t,{player:s,game:n})}}class et extends p{constructor(e,t,s){super(e,t,{countdown:s})}}class tt extends p{constructor(e,t,s,n,a){super(e,t,{slot:e,sender:s,item:n,location:a})}}function z(i,e){if(!i||!e||i.length!==e.length)return!1;const t=[...i].sort(),s=[...e].sort();return t.every((n,a)=>n===s[a])}function T(i,e){let t=e;return i!==null&&(t=Number(i),isNaN(t)&&(t=e)),t}const _=new Map,k=new Map;async function st(i){await W(i,re,oe),console.log("ALERTS",_,k)}function oe(i){const e=i||new URL(window.location.href).searchParams;for(const[t,s]of _){const n=e.get(`${t}-timeout`),a=e.get(`${t}-a`)?.split(","),o=e.get(`${t}-i`)?.split(","),r=e.get(`${t}-anim`),b=e.get(`${t}-anim-duration`),u=e.get(`${t}-anim-iterations`),m=e.get(`${t}-anim-timing`),S=T(n,s.timeout),d=T(b,s.animation.duration),J=T(u,s.animation.iterations);k.set(t,{name:t,alertReference:void 0,timeout:S,translations:void 0,audioReferences:a,imageReferences:o,animation:{reference:r,duration:d,iterations:J,timing:m}})}}function it(i){const e=i||new URLSearchParams;for(const[t,s]of _){const n=k.get(t);if(!n)continue;const a=(b,u,m)=>{if(u!=null){if(typeof u=="object"){if(JSON.stringify(u)===JSON.stringify(m))return}else if(u===m)return;e.set(b,String(u))}};a(`${t}-timeout`,n.timeout,s.timeout),n?.audioReferences&&!z(n?.audioReferences,s.audioReferences)&&e.set(`${t}-a`,n.audioReferences.join(",")),n?.imageReferences&&!z(n?.imageReferences,s.imageReferences)&&e.set(`${t}-i`,n.imageReferences.join(","));const o=n.animation,r=s.animation;o&&(a(`${t}-anim`,o.reference,r.reference),a(`${t}-anim-duration`,o.duration,r.duration),a(`${t}-anim-iterations`,o.iterations,r.iterations),a(`${t}-anim-timing`,o.timing,r.timing))}return e}function re(i){Object.entries(i).forEach(([e,t])=>{_.set(e,{name:e,alertReference:t["alert-reference"],timeout:t.timeout,translations:t.translations,audioReferences:t["audio-references"],imageReferences:t["image-references"],animation:t.animation}),k.set(e,{name:e,alertReference:void 0,timeout:void 0,translations:void 0,audioReferences:void 0,imageReferences:void 0,animation:{reference:void 0,duration:void 0,iterations:void 0,timing:void 0}})})}function nt(i,e){const t=G(i);if(!t)return;const s={name:i,alertReference:void 0,timeout:e?.timeout??t.timeout,translations:void 0,audioReferences:e?.audioReferences??t.audioReferences,imageReferences:e?.imageReferences??t.imageReferences,animation:{reference:e?.animation?.reference??t.animation.reference,duration:e?.animation?.duration??t.animation.duration,iterations:e?.animation?.iterations??t.animation.iterations,timing:e?.animation?.timing??t.animation.timing}};k.set(i,s)}function G(i){const e=_.get(i),t=k.get(i);return!e&&!t?null:{name:i,alertReference:e.alertReference,timeout:t?.timeout??e.timeout,translations:e.translations,audioReferences:t?.audioReferences??e.audioReferences,imageReferences:t?.imageReferences??e.imageReferences,animation:{reference:t?.animation.reference??e.animation.reference,duration:t?.animation?.duration??e.animation.duration,iterations:t?.animation?.iterations??e.animation.iterations,timing:t?.animation?.timing??e.animation.timing}}}function at(){const i=[];for(const[e,t]of _){const s=G(e);i.push(s)}return i}function ce(i,e){if(i==null)return!0;if(typeof i=="object"){if(JSON.stringify(i)===JSON.stringify(e))return!0}else if(i===e)return!0;return!1}function y(i,e,t,s){ce(t,s)||i.set(e,String(t))}var he=Object.defineProperty,le=(i,e)=>{for(var t in e)he(i,t,{get:e[t],enumerable:!0,configurable:!0,set:s=>e[t]=()=>s})},ue={};le(ue,{slotTypes:()=>x,permissions:()=>de,itemsHandlingFlags:()=>B,itemClassifications:()=>f,clientStatuses:()=>$});var $={disconnected:0,connected:5,ready:10,playing:20,goal:30},f={progression:1,useful:2,trap:4,none:0},B={minimal:0,others:1,own:2,starting:4,all:7},de={disabled:0,enabled:1,goal:2,auto:6,autoEnabled:7},x={spectator:0,player:1,group:2};class v extends Error{}class me extends Error{argumentName;value;constructor(e,t,s){super(e),this.argumentName=t,this.value=structuredClone(s)}}class fe extends Error{errors=[];constructor(e,t){super(e),this.errors=t}}class g extends Error{}var q={timeout:1e4,autoFetchDataPackage:!0,maximumMessages:1e3,debugLogVersions:!0},ge={major:0,minor:5,build:1},pe="2.0.4";function U(){const i=[];for(let e=0;e<36;e++)i.push(Math.floor(Math.random()*16));return i[14]=4,i[19]=i[19]&=-5,i[19]=i[19]|=8,i[8]=i[13]=i[18]=i[23]="-",i.map(e=>e.toString(16)).join("")}var M={password:"",uuid:U(),tags:[],version:ge,items:B.all,slotData:!0};class w{#e;#t;#s;#i;constructor(e,t,s,n){this.#e=e,this.#t=t,this.#s=s,this.#i=n}toString(){return this.name}get receiver(){return this.#i}get sender(){return this.#s}get name(){return this.#e.package.lookupItemName(this.game,this.#t.item,!0)}get id(){return this.#t.item}get locationName(){return this.#e.package.lookupLocationName(this.sender.game,this.#t.location,!0)}get locationId(){return this.#t.location}get locationGame(){return this.sender.game}get game(){return this.receiver.game}get progression(){return(this.flags&f.progression)===f.progression}get useful(){return(this.flags&f.useful)===f.useful}get trap(){return(this.flags&f.trap)===f.trap}get filler(){return this.flags===f.none}get flags(){return this.#t.flags}}class F{game;checksum;itemTable;locationTable;reverseItemTable;reverseLocationTable;constructor(e,t){this.game=e,this.checksum=t.checksum,this.itemTable=Object.freeze(t.item_name_to_id),this.locationTable=Object.freeze(t.location_name_to_id),this.reverseItemTable=Object.freeze(Object.fromEntries(Object.entries(this.itemTable).map(([s,n])=>[n,s]))),this.reverseLocationTable=Object.freeze(Object.fromEntries(Object.entries(this.locationTable).map(([s,n])=>[n,s])))}exportPackage(){return{checksum:this.checksum,item_name_to_id:{...this.itemTable},location_name_to_id:{...this.locationTable}}}}class ye{#e;#t=new Map;#s=new Map;#i=new Set;constructor(e){this.#e=e,this.#e.socket.on("roomInfo",t=>{this.#t.clear(),this.#s.clear(),this.#i.clear(),this.#t.set("Archipelago",this.#n());for(const s in t.datapackage_checksums)this.#s.set(s,t.datapackage_checksums[s]),this.#i.add(s)})}findPackage(e){return this.#t.get(e)??null}async fetchPackage(e=[],t=!0){e.length===0&&(e=Array.from(this.#i)),e=e.filter(n=>this.#i.has(n)?this.#t.get(n)?.checksum!==this.#s.get(n):!1);const s={games:{}};for(const n of e){const a={cmd:"GetDataPackage",games:[n]},[o]=await this.#e.socket.send(a).wait("dataPackage");s.games[n]=o.data.games[n]}return t&&this.importPackage(s),s}importPackage(e){for(const t in e.games)this.#t.set(t,new F(t,e.games[t])),this.#s.set(t,e.games[t].checksum)}exportPackage(){return{games:this.#t.entries().reduce((e,[t,s])=>(e[t]=s.exportPackage(),e),{})}}lookupItemName(e,t,s=!0){const n=`Unknown Item ${t}`,a=this.findPackage(e);if(!a)return s?n:void 0;const o=a.reverseItemTable[t];return s&&o===void 0?n:o}lookupLocationName(e,t,s=!0){const n=`Unknown Location ${t}`,a=this.findPackage(e);if(!a)return s?n:void 0;const o=a.reverseLocationTable[t];return s&&o===void 0?n:o}#n(){return new F("Archipelago",{checksum:"ac9141e9ad0318df2fa27da5f20c50a842afeecb",item_name_to_id:{Nothing:-1},location_name_to_id:{"Cheat Console":-1,Server:-2}})}}class we{#e;#t=[];#s;#i;constructor(e,t,s){this.#e=e,this.#s=t,this.#i=s}replace(e){return this.#t.push({operation:"replace",value:e}),this}default(){return this.#t.push({operation:"default",value:null}),this}add(e){return this.#t.push({operation:"add",value:e}),this}multiply(e){return this.#t.push({operation:"mul",value:e}),this}power(e){return this.#t.push({operation:"pow",value:e}),this}remainder(e){return this.#t.push({operation:"mod",value:e}),this}floor(){return this.#t.push({operation:"floor",value:null}),this}ceiling(){return this.#t.push({operation:"ceil",value:null}),this}max(e){return this.#t.push({operation:"max",value:e}),this}min(e){return this.#t.push({operation:"min",value:e}),this}and(e){return this.#t.push({operation:"and",value:e}),this}or(e){return this.#t.push({operation:"or",value:e}),this}xor(e){return this.#t.push({operation:"xor",value:e}),this}leftShift(e){return this.#t.push({operation:"left_shift",value:e}),this}rightShift(e){return this.#t.push({operation:"right_shift",value:e}),this}remove(e){return this.#t.push({operation:"remove",value:e}),this}pop(e){return this.#t.push({operation:"pop",value:e}),this}update(e){return this.#t.push({operation:"update",value:e}),this}async commit(e=!1){const t=U(),s={cmd:"Set",default:this.#i,key:this.#s,operations:this.#t,want_reply:e,uuid:t};if(this.#e.socket.send(s),!e)return;const[n]=await this.#e.socket.wait("setReply",a=>a.uuid===t);return n.value}}class be{#e;#t={};#s={};constructor(e){this.#e=e,this.#e.socket.on("disconnected",()=>{this.#t={},this.#s={}}).on("setReply",t=>{this.#t[t.key]=t.value;const s=this.#s[t.key];s&&s.forEach(n=>n(t.key,t.value,t.original_value))}).on("connected",()=>{if(this.#e.options.debugLogVersions){const t=`${this.#e.game}:${pe}:${navigator?.userAgent}`;this.prepare("archipelago.js__runtimes",{}).default().update({[t]:!0}).commit(!1)}})}get store(){return structuredClone(this.#t)}async fetch(e,t=!1){let s=typeof e=="string"?[e]:e;if(t){const a=s.filter(o=>this.#t[o]===void 0);a.length>0&&this.#e.socket.send({cmd:"SetNotify",keys:a})}let n={};if(s=s.filter(a=>{const o=structuredClone(this.#t[a]),r=o!==void 0;return r&&(n[a]=o),!r}),s.length>0){const a=await this.#i(s);n={...n,...a}}return t&&(this.#t={...this.#t,...n}),typeof e=="string"?n[e]:n}async notify(e,t){return e.forEach(s=>{this.#s[s]??=[],this.#s[s].push(t)}),this.fetch(e,!0)}prepare(e,t){if(e.startsWith("_read_"))throw TypeError("Cannot manipulate read only keys.");return new we(this.#e,e,t)}async fetchItemNameGroups(e){return await this.fetch([`_read_item_name_groups_${e}`],!0)}async fetchLocationNameGroups(e){return await this.fetch([`_read_location_name_groups_${e}`],!0)}async#i(e){const t=U(),[s]=await this.#e.socket.send({cmd:"Get",keys:e,uuid:t}).wait("retrieved",n=>n.uuid===t);return s.keys}}class ve{#e={};addEventListener(e,t,s=!1){this.#e[e]??=[],this.#e[e].push([t,s])}removeEventListener(e,t){const s=this.#e[e];s&&s.length>0&&(this.#e[e]=s.filter(([n])=>n!==t))}dispatchEvent(e,t){const s=this.#e[e]??[];for(const[n,a]of s)n(...t),a&&this.removeEventListener(e,n)}}class P{#e=new ve;on(e,t){return this.#e.addEventListener(e,t),this}off(e,t){return this.#e.removeEventListener(e,t),this}async wait(e,t=()=>!0){return new Promise(s=>{const n=(...a)=>{t(...a)&&(this.#e.removeEventListener(e,n),s(a))};this.#e.addEventListener(e,n)})}emit(e,t){this.#e.dispatchEvent(e,t)}}class _e extends P{#e;#t=Number.MIN_SAFE_INTEGER;constructor(e){super(),this.#e=e,this.#e.socket.on("bounced",t=>{if(t.tags?.includes("DeathLink")&&t.data.time&&t.data.source){const s=t.data;if(s.time===this.#t)return;this.#t=s.time,this.emit("deathReceived",[s.source,s.time*1e3,s.cause])}})}get enabled(){return this.#e.arguments.tags.includes("DeathLink")}enableDeathLink(){this.#e.arguments.tags.includes("DeathLink")||this.#e.updateTags([...this.#e.arguments.tags,"DeathLink"])}disableDeathLink(){this.#e.arguments.tags.includes("DeathLink")&&this.#e.updateTags(this.#e.arguments.tags.filter(e=>e!=="DeathLink"))}sendDeathLink(e,t){if(!this.#e.authenticated)throw new g("Cannot send death links before connecting and authenticating.");if(!this.enabled)return;this.#t=Math.ceil(Date.now()/1e3);const s={source:e,cause:t,time:this.#t};this.#e.bounce({tags:["DeathLink"]},s)}}class L{#e;#t;#s;constructor(e,t){this.#e=e,this.#t=t,this.#s=new w(this.#e,{item:t.item,location:t.location,player:t.finding_player,flags:t.item_flags},this.#e.players.findPlayer(t.finding_player),this.#e.players.findPlayer(t.receiving_player))}get item(){return this.#s}get found(){return this.#t.found}get entrance(){return this.#t.entrance||"Vanilla"}}class ke extends P{#e;#t=[];#s=[];constructor(e){super(),this.#e=e,this.#e.socket.on("receivedItems",t=>{let s=t.index;const n=t.items.length,a=[...t.items];for(;a.length>0;){const o=a.shift();this.#t[s++]=new w(this.#e,o,this.#e.players.findPlayer(o.player),this.#e.players.self)}this.emit("itemsReceived",[this.#t.slice(t.index,t.index+n),t.index])}).on("connected",()=>{this.#s=[],this.#t=[],this.#e.storage.notify([`_read_hints_${this.#e.players.self.team}_${this.#e.players.self.slot}`],this.#i.bind(this)).then(t=>{const s=t[`_read_hints_${this.#e.players.self.team}_${this.#e.players.self.slot}`];this.#s=s.map(n=>new L(this.#e,n)),this.emit("hintsInitialized",[this.#s])}).catch(t=>{throw t})})}get received(){return[...this.#t]}get hints(){return[...this.#s]}get count(){return this.#t.length}#i(e,t){for(let s=0;s<t.length;s++)this.#s[s]===void 0?(this.#s[s]=new L(this.#e,t[s]),this.emit("hintReceived",[this.#s[s]])):this.#s[s].found!==t[s].found&&(this.#s[s]=new L(this.#e,t[s]),this.emit("hintFound",[this.#s[s]]))}}class C{client;part;constructor(e,t){this.client=e,this.part=t}toString(){return this.text}}class Pe extends C{part;type="item";item;constructor(e,t,s,n){super(e,t);const a=e.players.findPlayer(t.player,n.team);this.part=t,this.item=new w(e,s,a,n)}get text(){return this.item.name}}class Se extends C{#e;part;type="location";id;constructor(e,t){super(e,t);const s=e.players.findPlayer(t.player),n=e.package.findPackage(s.game);this.part=t,t.type==="location_name"?(this.#e=t.text,this.id=n.locationTable[t.text]):(this.id=parseInt(t.text),this.#e=e.package.lookupLocationName(s.game,this.id,!0))}get text(){return this.#e}}class Ce extends C{part;type="color";color;constructor(e,t){super(e,t),this.part=t,this.color=t.color}get text(){return this.part.text}}class Ae extends C{part;type;constructor(e,t){super(e,t),this.part=t,this.part.type==="entrance_name"?this.type="entrance":this.type="text"}get text(){return this.part.text}}class xe extends C{part;type="player";player;constructor(e,t){if(super(e,t),this.part=t,t.type==="player_id")this.player=e.players.findPlayer(parseInt(t.text));else{const s=e.players.teams[e.players.self.team].find(n=>n.name===t.text);if(!s)throw new Error(`Cannot find player under name: ${t.text}`);this.player=s}}get text(){return this.player.alias}}class Le extends P{#e;#t=[];get log(){return[...this.#t]}constructor(e){super(),this.#e=e,this.#e.socket.on("printJSON",this.#s.bind(this))}async say(e){if(!this.#e.authenticated)throw new g("Cannot send chat messages without being authenticated.");e=e.trim();const t={cmd:"Say",text:e};this.#e.socket.send(t),await this.wait("chat",s=>s===e)}#s(e){const t=[];for(const n of e.data)switch(n.type){case"item_id":case"item_name":{const a=e;let o;a.type==="ItemCheat"?o=this.#e.players.findPlayer(a.receiving,a.team):o=this.#e.players.findPlayer(a.receiving),t.push(new Pe(this.#e,n,a.item,o));break}case"location_id":case"location_name":{t.push(new Se(this.#e,n));break}case"color":{t.push(new Ce(this.#e,n));break}case"player_id":case"player_name":{t.push(new xe(this.#e,n));break}default:{t.push(new Ae(this.#e,n));break}}const s=t.map(n=>n.text).join();switch(this.#e.options.maximumMessages>=1&&(this.log.push({text:s,nodes:t}),this.log.splice(0,this.log.length-this.#e.options.maximumMessages)),e.type){case"ItemSend":{const n=this.#e.players.findPlayer(e.item.player),a=this.#e.players.findPlayer(e.receiving),o=new w(this.#e,e.item,n,a);this.emit("itemSent",[s,o,t]);break}case"ItemCheat":{const n=this.#e.players.findPlayer(e.item.player,e.team),a=this.#e.players.findPlayer(e.receiving,e.team),o=new w(this.#e,e.item,n,a);this.emit("itemCheated",[s,o,t]);break}case"Hint":{const n=this.#e.players.findPlayer(e.item.player),a=this.#e.players.findPlayer(e.receiving),o=new w(this.#e,e.item,n,a);this.emit("itemHinted",[s,o,e.found,t]);break}case"Join":{const n=this.#e.players.findPlayer(e.slot,e.team);this.emit("connected",[s,n,e.tags,t]);break}case"Part":{const n=this.#e.players.findPlayer(e.slot,e.team);this.emit("disconnected",[s,n,t]);break}case"Chat":{const n=this.#e.players.findPlayer(e.slot,e.team);this.emit("chat",[e.message,n,t]);break}case"ServerChat":{this.emit("serverChat",[e.message,t]);break}case"TagsChanged":{const n=this.#e.players.findPlayer(e.slot,e.team);this.emit("tagsUpdated",[s,n,e.tags,t]);break}case"Tutorial":{this.emit("tutorial",[s,t]);break}case"CommandResult":{this.emit("userCommand",[s,t]);break}case"AdminCommandResult":{this.emit("adminCommand",[s,t]);break}case"Goal":{const n=this.#e.players.findPlayer(e.slot,e.team);this.emit("goaled",[s,n,t]);break}case"Release":{const n=this.#e.players.findPlayer(e.slot,e.team);this.emit("released",[s,n,t]);break}case"Collect":{const n=this.#e.players.findPlayer(e.slot,e.team);this.emit("collected",[s,n,t]);break}case"Countdown":this.emit("countdown",[s,e.countdown,t])}this.emit("message",[s,t])}}class A{#e;#t;constructor(e,t){this.#e=e,this.#t=t}toString(){return this.alias}get name(){return this.#t.name}get alias(){return this.#t.alias}get game(){return this.slot===0?"Archipelago":this.#s.game}get type(){return this.slot===0?x.spectator:this.#s.type}get team(){return this.#t.team}get slot(){return this.#t.slot}get members(){return this.type!==x.group?[]:this.#e.players.teams[this.team].filter(e=>this.#s.group_members.includes(e.slot))}get groups(){return this.slot===0?[]:this.#e.players.teams[this.team].filter(e=>e.slot!==0&&this.#e.players.slots[e.slot].group_members.includes(this.slot))}async fetchStatus(){return this.type===x.group?$.goal:await this.#e.storage.fetch(`_read_client_status_${this.team}_${this.slot}`)??0}async fetchSlotData(){return await this.#e.storage.fetch(`_read_slot_data_${this.slot}`)}async fetchHints(){return(await this.#e.storage.fetch(`_read_hints_${this.team}_${this.slot}`)).map(t=>new L(this.#e,t))}get#s(){return this.#e.players.slots[this.slot]}}class Re extends P{#e;#t=[];#s={};#i=0;#n=0;constructor(e){super(),this.#e=e,this.#e.socket.on("connected",t=>{this.#s=Object.freeze(t.slot_info),this.#t=[],this.#i=t.slot,this.#n=t.team;for(const s of t.players)this.#t[s.team]??=[{team:s.team,slot:0,name:"Archipelago",alias:"Archipelago"}],this.#t[s.team][s.slot]=s}).on("roomUpdate",t=>{if(t.players){for(const s of t.players)if(this.#t[s.team][s.slot].alias!==s.alias){const n=this.#t[s.team][s.slot].alias;this.#t[s.team][s.slot]=s,this.emit("aliasUpdated",[new A(this.#e,s),n,s.alias])}}})}get self(){if(this.#i===0)throw new Error("Cannot lookup own player object when client has never connected to a server.");return new A(this.#e,this.#t[this.#n][this.#i])}get slots(){return this.#s}get teams(){const e=[];for(let t=0;t<this.#t.length;t++){e[t]=[];for(let s=0;s<this.#t[t].length;s++)e[t].push(new A(this.#e,this.#t[t][s]))}return e}findPlayer(e,t){if(t===void 0&&(t=this.#e.players.self.team),this.#t[t])return new A(this.#e,this.#t[t][e])}}class Ie extends P{#e;#t={major:-1,minor:-1,build:-1};#s={major:-1,minor:-1,build:-1};#i=[];#n=[];#d="";#l=!1;#o=0;#u=0;#r=0;#c={release:0,collect:0,remaining:0};#h=[];#a=[];#m=!1;get serverVersion(){return{...this.#t}}get generatorVersion(){return{...this.#s}}get games(){return[...this.#i]}get tags(){return[...this.#n]}get seedName(){return this.#d}get password(){return this.#l}get permissions(){return{...this.#c}}get hintPoints(){return this.#o}get hintCost(){return this.hintCostPercentage>0?Math.max(1,Math.floor(this.hintCostPercentage*this.allLocations.length*.01)):0}get hintCostPercentage(){return this.#u}get locationCheckPoints(){return this.#r}get missingLocations(){return[...this.#h].sort()}get checkedLocations(){return[...this.#a].sort()}get allLocations(){return[...this.#h,...this.#a].sort()}get race(){return this.#m}constructor(e){super(),this.#e=e,this.#e.socket.on("roomInfo",t=>{this.#t={major:t.version.major,minor:t.version.minor,build:t.version.build},this.#s={major:t.generator_version.major,minor:t.generator_version.minor,build:t.generator_version.build},this.#n=t.tags,this.#i=t.games,this.#d=t.seed_name,this.#l=t.password,this.#c=t.permissions,this.#u=t.hint_cost,this.#r=t.location_check_points}).on("connected",t=>{this.#h=t.missing_locations,this.#a=t.checked_locations,this.emit("locationsChecked",[this.checkedLocations]),this.#o=t.hint_points,this.emit("hintPointsUpdated",[0,t.hint_points])}).on("roomUpdate",t=>{if(t.hint_cost!==void 0){const[s,n]=[this.hintCost,this.hintCostPercentage];this.#u=t.hint_cost,this.emit("hintCostUpdated",[s,this.hintCost,n,this.hintCostPercentage])}if(t.hint_points!==void 0){const s=this.#o;this.#o=t.hint_points,this.emit("hintPointsUpdated",[s,this.hintPoints])}if(t.location_check_points!==void 0){const s=this.#r;this.#r=t.location_check_points,this.emit("locationCheckPointsUpdated",[s,this.locationCheckPoints])}if(t.password!==void 0&&(this.#l=t.password,this.emit("passwordUpdated",[this.password])),t.permissions!==void 0){const s=this.#c;this.#c=t.permissions,this.emit("permissionsUpdated",[s,this.permissions])}t.checked_locations!==void 0&&(this.#a=[...this.#a,...t.checked_locations],this.#h=this.missingLocations.filter(s=>!t.checked_locations?.includes(s)),this.emit("locationsChecked",[t.checked_locations]))})}}class Te extends P{#e=null;#t=!1;constructor(){super()}get connected(){return this.#t}get url(){return this.#e?.url??""}send(...e){if(this.#e)return this.#e.send(JSON.stringify(e)),this.emit("sentPackets",[e]),this;throw new v("Unable to send packets to the server; not connected to a server.")}async connect(e){if(this.disconnect(),typeof e=="string"){if(!/^([a-zA-Z]+:)\/\/[A-Za-z0-9_.~\-:]+/i.test(e))try{return await this.connect(new URL(`wss://${e}`))}catch{return await this.connect(new URL(`ws://${e}`))}e=new URL(e)}if(e.port=e.port||"38281",e.protocol!=="wss:"&&e.protocol!=="ws:")throw new TypeError("Unexpected protocol. Archipelago only supports the ws:// and wss:// protocols.");try{return new Promise((t,s)=>{const n=this.#i();if(n===null)throw new v("Unable to find a suitable WebSocket API in the current runtime.");this.#e=new n(e),this.#e.onmessage=this.#s.bind(this),this.#e.onclose=()=>{this.disconnect(),s(new v("Failed to connect to Archipelago server."))},this.#e.onerror=()=>{this.disconnect(),s(new v("Failed to connect to Archipelago server."))},this.#e.onopen=()=>{this.wait("roomInfo").then(([a])=>{if(this.#t=!0,this.#e){this.#e.onclose=this.disconnect.bind(this),this.#e.onerror=this.disconnect.bind(this),t(a);return}this.disconnect(),s(new v("Failed to connect to Archipelago server."))}).catch(a=>{throw a})}})}catch(t){throw this.disconnect(),t}}disconnect(){this.connected&&(this.#t=!1,this.#e?.close(),this.#e=null,this.emit("disconnected",[]))}#s(e){const t=JSON.parse(e.data);for(const s of t){switch(s.cmd){case"ConnectionRefused":this.emit("connectionRefused",[s]);break;case"Bounced":this.emit("bounced",[s,s.data]);break;case"Connected":this.emit("connected",[s]);break;case"DataPackage":this.emit("dataPackage",[s]);break;case"InvalidPacket":this.emit("invalidPacket",[s]);break;case"LocationInfo":this.emit("locationInfo",[s]);break;case"PrintJSON":this.emit("printJSON",[s]);break;case"ReceivedItems":this.emit("receivedItems",[s]);break;case"Retrieved":this.emit("retrieved",[s]);break;case"RoomInfo":this.emit("roomInfo",[s]);break;case"RoomUpdate":this.emit("roomUpdate",[s]);break;case"SetReply":this.emit("setReply",[s]);break}this.emit("receivedPacket",[s])}}#i(){let e=null;return typeof window<"u"?e=window.WebSocket||window.MozWebSocket:typeof global<"u"?e=global.WebSocket||global.MozWebSocket:typeof self<"u"?e=self.WebSocket||self.MozWebSocket:typeof WebSocket<"u"?e=WebSocket:typeof MozWebSocket<"u"&&(e=MozWebSocket),e}}class Me{#e=!1;#t=M;#s="";#i="";socket=new Te;package=new ye(this);storage=new be(this);room=new Ie(this);players=new Re(this);items=new ke(this);messages=new Le(this);deathLink=new _e(this);options;get authenticated(){return this.socket.connected&&this.#e}get name(){return this.#s}get game(){return this.#i}get arguments(){return{...this.#t}}constructor(e){e?this.options={...q,...e}:this.options={...q},this.socket.on("disconnected",()=>{this.#e=!1}).on("sentPackets",t=>{for(const s of t)s.cmd==="ConnectUpdate"&&(this.#t.tags=s.tags,this.#t.items=s.items_handling)})}async login(e,t,s="",n){if(t==="")throw new me("Provided slot name cannot be blank.","name",t);n?this.#t={...M,...n}:this.#t={...M};const a=new Set(this.arguments.tags);!s&&!a.has("HintGame")&&!a.has("Tracker")&&!a.has("TextOnly")&&a.add("TextOnly"),this.#t.tags=Array.from(a);const o={cmd:"Connect",name:t,game:s,password:this.arguments.password,slot_data:this.arguments.slotData,items_handling:this.arguments.items,uuid:this.arguments.uuid,tags:this.arguments.tags,version:{...this.arguments.version,class:"Version"}};return await this.socket.connect(e),this.options.autoFetchDataPackage&&await this.package.fetchPackage(),new Promise((r,b)=>{const u=setTimeout(()=>b(new v("Server failed to respond in time.")),this.options.timeout),m=d=>{this.#e=!0,this.#i=d.slot_info[d.slot].game,this.#s=d.slot_info[d.slot].name,this.socket.off("connected",m).off("connectionRefused",S),clearTimeout(u),r(d.slot_data)},S=d=>{this.socket.off("connected",m).off("connectionRefused",S),clearTimeout(u),b(new fe(`Connection was refused by the server. Reason(s): [${d.errors?.join(", ")}`,d.errors??[]))};this.socket.on("connected",m.bind(this)).on("connectionRefused",S.bind(this)).send(o)})}updateStatus(e){if(!this.authenticated)throw new g("Cannot update status while not connected and authenticated.");this.socket.send({cmd:"StatusUpdate",status:e})}goal(){this.updateStatus($.goal)}updateTags(e){if(!this.authenticated)throw new g("Cannot update tags while not connected and authenticated.");this.socket.send({cmd:"ConnectUpdate",tags:e,items_handling:this.arguments.items})}updateItemsHandling(e){if(!this.authenticated)throw new g("Cannot update tags while not connected and authenticated.");this.socket.send({cmd:"ConnectUpdate",tags:this.arguments.tags,items_handling:e})}check(...e){if(!this.authenticated)throw new g("Cannot check locations while not connected and authenticated.");e=e.filter(t=>this.room.missingLocations.includes(t)),this.socket.send({cmd:"LocationChecks",locations:e})}async scout(e,t=0){if(!this.authenticated)throw new g("Cannot scout locations while not connected and authenticated.");e=e.filter(n=>this.room.allLocations.includes(n));const[s]=await this.socket.send({cmd:"LocationScouts",create_as_hint:t,locations:e}).wait("locationInfo",n=>n.locations.map(a=>a.location).toSorted().join(",")===e.toSorted().join(","));return s.locations.map(n=>new w(this,n,this.players.self,this.players.findPlayer(n.player)))}bounce(e,t){if(!this.authenticated)throw new g("Cannot send bounces while not connected and authenticated.");this.socket.send({cmd:"Bounce",data:t,games:e.games??[],slots:e.slots??[],tags:e.tags??[]})}}let h;function ot(){h={url:void 0,slots:void 0,password:void 0},Ne()}function Ne(i){const e=i||new URL(window.location.href).searchParams,t=e.get("archipelago-url"),s=e.get("archipelago-slots")?.split(",")||[],n=e.get("archipelago-password");h={url:t,slots:s,password:n}}function rt(i){const e=i||new URLSearchParams;if(!h)return e;y(i,"archipelago-url",h.url,null),y(i,"archipelago-slots",h.slots,[]),y(i,"archipelago-password",h.password,null)}function ct(i){h={url:i?.url??h.url,slots:i?.slots??h.slots,password:i?.password??h.password}}function ht(){return h}const Ee=new Map;function lt(i,e,t){const s=h;if(!(!s.slots||s.slots.length===0))for(const n of s.slots)$e(s.url,n,s.password,e,t)}async function $e(i,e,t,s,n){const a=new Me;try{s&&s(a,e),await a.login(i,e,void 0,{password:t||""}),Ee.set(e,a)}catch(o){console.error(o),n&&n(e)}}let c,l;const Ue={"system-ui":"System UI","-apple-system":"Apple System",BlinkMacSystemFont:"BlinkMac System Font",SegoeUI:"Segoe UI",Roboto:"Roboto",HelveticaNeue:"Helvetica Neue",Arial:"Arial",NotoSans:"Noto Sans",LiberationSans:"Liberation Sans",Georgia:"Georgia",TimesNewRoman:"Times New Roman",Times:"Times",PalatinoLinotype:"Palatino Linotype",BookAntiqua:"Book Antiqua",Consolas:"Consolas",Menlo:"Menlo",Monaco:"Monaco",CourierNew:"Courier New",LiberationMono:"Liberation Mono","sans-serif":"Sans-serif",serif:"Serif",monospace:"Monospace"},je={normal:"Normal",bold:"Bold",italic:"Italic",bi:"Bold + Italic"},De={normal:"None",small:"Small",medium:"Medium",large:"Large"};function ut(){c={family:"Arial",size:"12",style:"normal",shadow:"normal"},l={family:void 0,size:void 0,style:void 0,shadow:void 0},Oe()}function Oe(i){const e=i||new URL(window.location.href).searchParams,t=e.get("font-family"),s=e.get("font-size"),n=e.get("font-style"),a=e.get("font-shadow");l={family:t??c.family,size:s??c.size,style:n??c.style,shadow:a??c.shadow},console.log("FONT",l)}function dt(i){const e=i||new URLSearchParams;return y(e,"font-family",l.family,c.family),y(e,"font-size",l.size,c.size),y(e,"font-style",l.style,c.style),y(e,"font-shadow",l.shadow,c.shadow),e}function mt(i){const e=ze();l={family:i.family??e.family,size:i.size??e.size,style:i.style??e.style,shadow:i.shadow??e.shadow}}function ze(){return{family:l?.family??c.family,size:l?.size??c.size,style:l?.style??c.style,shadow:l?.shadow??c.shadow}}function ft(){return Ue}function gt(){return je}function pt(){return De}export{p as A,it as B,Ve as C,We as D,Ne as E,Oe as F,Ye as G,tt as H,Ze as I,oe as J,T as S,ut as a,Je as b,He as c,qe as d,st as e,lt as f,G as g,Qe as h,Ke as i,et as j,Xe as k,ot as l,at as m,ft as n,gt as o,pt as p,ht as q,ze as r,ct as s,mt as t,nt as u,Fe as v,Ge as w,Be as x,rt as y,dt as z};
