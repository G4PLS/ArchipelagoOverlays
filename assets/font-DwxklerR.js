async function W(i,t,e){try{const s=await fetch(i);if(!s.ok)return;const n=await s.json();t(n),e?.()}catch(s){console.error(s)}}async function V(i,t,e){try{const s=await fetch(i);if(!s.ok)return;const n=await s.json();t(n),e?.()}catch(s){console.error(s)}}const G=[];async function qt(i){await W(i,Q)}function Q(i){const t=[];Object.entries(i).forEach(([e,s])=>{const n=K(e,s);t.push(n),G.push(e)}),Z(t.join(`
`))}function K(i,t){const e=[`@keyframes ${i} {`];for(const[s,n]of Object.entries(t)){const a=Object.entries(n).map(([o,r])=>`    ${o}: ${r};`).join(" ");e.push(`  ${s} { ${a} }`)}return e.push("}"),e.join(`
`)}function Z(i){let t=document.querySelector("#dynamic-animation-styles");t||(t=document.createElement("style"),t.id="dynamic-animation-styles",document.head.appendChild(t)),t.textContent=i+`
`}function Ft(){return G}function X(i,t){!i||!t||(i.style.animationName=t.reference,i.style.animationDuration=`${t.duration}ms`,i.style.animationTimingFunction=t.timing,i.style.animationIterationCount=t.iterations.toString(),i.offsetWidth)}function j(i){i&&(i.style.animationName="",i.style.animationDuration="",i.style.animationTimingFunction="",i.style.animationIterationCount="",i.offsetWidth)}var N=(i=>(i[i.LOW=0]="LOW",i[i.CRITICAL=1]="CRITICAL",i))(N||{});class Y extends EventTarget{data={0:[],1:[]};locked=!1;push(t,e){this.data[e].push(t),this.dispatchEvent(new Event("element-pushed"))}pop(){return this.data[1].length>0?this.data[1].shift():this.locked?null:this.data[0].shift()}lock(){this.locked=!0}unlock(){this.locked=!1}isEmpty(){return Object.values(this.data).every(t=>t.length===0)}}class tt{timeout;cancel(){clearTimeout(this.timeout)}}class Wt{queue=new Y;displayContainer;isAnimating=!1;currentAnimatingItem=null;constructor(t){this.displayContainer=t,this.queue.addEventListener("element-pushed",async()=>{await this.processQueue()})}push(t,e){const s=e?N.CRITICAL:N.LOW;this.queue.push(t,s)}async processQueue(){this.isAnimating||(this.isAnimating=!0,this.displayContainer.style.display="",await this.displayItem(),this.isAnimating=!1)}async displayItem(){for(;!this.queue.isEmpty();){const t=this.queue.pop();t&&(this.currentAnimatingItem=t,this.displayContainer.style.visibility="",await t.display(this.displayContainer),this.displayContainer.style.visibility="hidden")}}cancel(){this.currentAnimatingItem&&(this.currentAnimatingItem.cancel(),this.currentAnimatingItem=null,this.displayContainer.style.visibility="hidden",this.displayItem())}lockQueue(){this.queue.lock()}unlockQueue(){this.queue.unlock()}}const x=new Map,I=new Map;async function Gt(i){await V(i,et),console.log("MEDIA",x,I)}function et(i){D(x,i.images),D(I,i.audios)}function D(i,t){Object.entries(t).forEach(([e,s])=>{i.set(e,s)})}function Ht(){return Array.from(x.keys())}function Bt(){return Array.from(I.keys())}function st(i){return I.get(i)}function it(i){return x.get(i)}const nt="en";let E="en";function Jt(){E=new URL(window.location.href).searchParams.get("lang")||nt,console.log("LANGUAGE",E)}function at(i,t,e){if(!e)return"";const s=e[E];return s?i?s.replace(/{{(\w+)}}/g,(a,o)=>{if(!(o in i))return console.error(`{{${o}}} is not defined in "${s}"`),"";const r=i[o]??"";return`<span class="variable ${o} ${t}-${o}">${r}</span>`}):s:""}function O(i){if(i.length!==0)return i[Math.floor(Math.random()*i.length)]}class P extends tt{slot;config;variables;resolveDisplay;constructor(t,e,s){super(),this.slot=t,this.config=e,this.variables=s}cancel(){const t=document.querySelector(".alert-audio");t&&(t.pause(),t.currentTime=0,t.removeAttribute("src"));const e=document.querySelector(".alert-container");e&&j(e);const s=document.querySelector(".alert-image");s&&s.removeAttribute("src");const n=document.querySelector(".alert-text");n&&(n.innerHTML=""),this.resolveDisplay&&this.resolveDisplay()}async display(t){return new Promise(e=>{this.resolveDisplay=e,this.setAudio(t),this.setText(t),this.setImage(t),this.setAnimation(t),this.timeout=setTimeout(()=>{j(t),this.resolveDisplay=void 0,e()},this.config.timeout)})}setText(t){const e=t.querySelector(".alert-text");if(e){const s=at(this.variables,this.config.name,this.config.translations);s!==null&&(e.innerHTML=s)}}setImage(t){const e=t.querySelector(".alert-image");if(this.config.imageReferences&&e){const s=O(this.config.imageReferences),n=it(s);n===""||n===void 0?(e.removeAttribute("src"),e.style.visibility="hidden"):(e.src=n,e.style.visibility="")}}setAudio(t){const e=t.querySelector(".alert-audio");if(this.config.audioReferences.length>0&&e){const s=O(this.config.audioReferences),n=st(s);n===""||n===void 0?(e.pause(),e.removeAttribute("src")):(e.src=n,e.play())}}setAnimation(t){this.config.animation&&X(t,{...this.config.animation,duration:this.config.animation.duration||this.config.timeout})}}class Vt extends P{constructor(t,e){super(t,e,{slot:t})}}class Qt extends P{constructor(t,e){super(t,e,{slot:t})}}class Kt extends P{constructor(t,e,s,n){super(t,e,{slot:t,sender:n,item:s})}}class Zt extends P{constructor(t,e,s,n){super(t,e,{player:s,game:n})}}class Xt extends P{constructor(t,e,s){super(t,e,{countdown:s})}}function z(i,t){if(!i||!t||i.length!==t.length)return!1;const e=[...i].sort(),s=[...t].sort();return e.every((n,a)=>n===s[a])}function T(i,t){let e=t;return i!==null&&(e=Number(i),isNaN(e)&&(e=t)),e}const b=new Map,v=new Map;async function Yt(i){await W(i,rt,ot),console.log("ALERTS",b,v)}function ot(i){const t=i||new URL(window.location.href).searchParams;for(const[e,s]of b){const n=t.get(`${e}-timeout`),a=t.get(`${e}-a`)?.split(","),o=t.get(`${e}-i`)?.split(","),r=t.get(`${e}-anim`),y=t.get(`${e}-anim-duration`),u=t.get(`${e}-anim-iterations`),m=t.get(`${e}-anim-timing`),k=T(n,s.timeout),d=T(y,s.animation.duration),J=T(u,s.animation.iterations);v.set(e,{name:e,alertReference:void 0,timeout:k,translations:void 0,audioReferences:a,imageReferences:o,animation:{reference:r,duration:d,iterations:J,timing:m}})}}function te(i){const t=i||new URLSearchParams;for(const[e,s]of b){const n=v.get(e);if(!n)continue;const a=(y,u,m)=>{if(u!=null){if(typeof u=="object"){if(JSON.stringify(u)===JSON.stringify(m))return}else if(u===m)return;t.set(y,String(u))}};a(`${e}-timeout`,n.timeout,s.timeout),n?.audioReferences&&!z(n?.audioReferences,s.audioReferences)&&t.set(`${e}-a`,n.audioReferences.join(",")),n?.imageReferences&&!z(n?.imageReferences,s.imageReferences)&&t.set(`${e}-i`,n.imageReferences.join(","));const o=n.animation,r=s.animation;o&&(a(`${e}-anim`,o.reference,r.reference),a(`${e}-anim-duration`,o.duration,r.duration),a(`${e}-anim-iterations`,o.iterations,r.iterations),a(`${e}-anim-timing`,o.timing,r.timing))}return t}function rt(i){Object.entries(i).forEach(([t,e])=>{b.set(t,{name:t,alertReference:e["alert-reference"],timeout:e.timeout,translations:e.translations,audioReferences:e["audio-references"],imageReferences:e["image-references"],animation:e.animation}),v.set(t,{name:t,alertReference:void 0,timeout:void 0,translations:void 0,audioReferences:void 0,imageReferences:void 0,animation:{reference:void 0,duration:void 0,iterations:void 0,timing:void 0}})})}function ee(i,t){const e=H(i);if(!e)return;const s={name:i,alertReference:void 0,timeout:t?.timeout??e.timeout,translations:void 0,audioReferences:t?.audioReferences??e.audioReferences,imageReferences:t?.imageReferences??e.imageReferences,animation:{reference:t?.animation?.reference??e.animation.reference,duration:t?.animation?.duration??e.animation.duration,iterations:t?.animation?.iterations??e.animation.iterations,timing:t?.animation?.timing??e.animation.timing}};v.set(i,s)}function H(i){const t=b.get(i),e=v.get(i);return!t&&!e?null:{name:i,alertReference:t.alertReference,timeout:e?.timeout??t.timeout,translations:t.translations,audioReferences:e?.audioReferences??t.audioReferences,imageReferences:e?.imageReferences??t.imageReferences,animation:{reference:e?.animation.reference??t.animation.reference,duration:e?.animation?.duration??t.animation.duration,iterations:e?.animation?.iterations??t.animation.iterations,timing:e?.animation?.timing??t.animation.timing}}}function se(){const i=[];for(const[t,e]of b){const s=H(t);i.push(s)}return i}var ct=Object.defineProperty,ht=(i,t)=>{for(var e in t)ct(i,e,{get:t[e],enumerable:!0,configurable:!0,set:s=>t[e]=()=>s})},lt={};ht(lt,{slotTypes:()=>L,permissions:()=>ut,itemsHandlingFlags:()=>B,itemClassifications:()=>f,clientStatuses:()=>$});var $={disconnected:0,connected:5,ready:10,playing:20,goal:30},f={progression:1,useful:2,trap:4,none:0},B={minimal:0,others:1,own:2,starting:4,all:7},ut={disabled:0,enabled:1,goal:2,auto:6,autoEnabled:7},L={spectator:0,player:1,group:2};class w extends Error{}class dt extends Error{argumentName;value;constructor(t,e,s){super(t),this.argumentName=e,this.value=structuredClone(s)}}class mt extends Error{errors=[];constructor(t,e){super(t),this.errors=e}}class g extends Error{}var q={timeout:1e4,autoFetchDataPackage:!0,maximumMessages:1e3,debugLogVersions:!0},ft={major:0,minor:5,build:1},gt="2.0.4";function U(){const i=[];for(let t=0;t<36;t++)i.push(Math.floor(Math.random()*16));return i[14]=4,i[19]=i[19]&=-5,i[19]=i[19]|=8,i[8]=i[13]=i[18]=i[23]="-",i.map(t=>t.toString(16)).join("")}var M={password:"",uuid:U(),tags:[],version:ft,items:B.all,slotData:!0};class p{#t;#e;#s;#i;constructor(t,e,s,n){this.#t=t,this.#e=e,this.#s=s,this.#i=n}toString(){return this.name}get receiver(){return this.#i}get sender(){return this.#s}get name(){return this.#t.package.lookupItemName(this.game,this.#e.item,!0)}get id(){return this.#e.item}get locationName(){return this.#t.package.lookupLocationName(this.sender.game,this.#e.location,!0)}get locationId(){return this.#e.location}get locationGame(){return this.sender.game}get game(){return this.receiver.game}get progression(){return(this.flags&f.progression)===f.progression}get useful(){return(this.flags&f.useful)===f.useful}get trap(){return(this.flags&f.trap)===f.trap}get filler(){return this.flags===f.none}get flags(){return this.#e.flags}}class F{game;checksum;itemTable;locationTable;reverseItemTable;reverseLocationTable;constructor(t,e){this.game=t,this.checksum=e.checksum,this.itemTable=Object.freeze(e.item_name_to_id),this.locationTable=Object.freeze(e.location_name_to_id),this.reverseItemTable=Object.freeze(Object.fromEntries(Object.entries(this.itemTable).map(([s,n])=>[n,s]))),this.reverseLocationTable=Object.freeze(Object.fromEntries(Object.entries(this.locationTable).map(([s,n])=>[n,s])))}exportPackage(){return{checksum:this.checksum,item_name_to_id:{...this.itemTable},location_name_to_id:{...this.locationTable}}}}class pt{#t;#e=new Map;#s=new Map;#i=new Set;constructor(t){this.#t=t,this.#t.socket.on("roomInfo",e=>{this.#e.clear(),this.#s.clear(),this.#i.clear(),this.#e.set("Archipelago",this.#n());for(const s in e.datapackage_checksums)this.#s.set(s,e.datapackage_checksums[s]),this.#i.add(s)})}findPackage(t){return this.#e.get(t)??null}async fetchPackage(t=[],e=!0){t.length===0&&(t=Array.from(this.#i)),t=t.filter(n=>this.#i.has(n)?this.#e.get(n)?.checksum!==this.#s.get(n):!1);const s={games:{}};for(const n of t){const a={cmd:"GetDataPackage",games:[n]},[o]=await this.#t.socket.send(a).wait("dataPackage");s.games[n]=o.data.games[n]}return e&&this.importPackage(s),s}importPackage(t){for(const e in t.games)this.#e.set(e,new F(e,t.games[e])),this.#s.set(e,t.games[e].checksum)}exportPackage(){return{games:this.#e.entries().reduce((t,[e,s])=>(t[e]=s.exportPackage(),t),{})}}lookupItemName(t,e,s=!0){const n=`Unknown Item ${e}`,a=this.findPackage(t);if(!a)return s?n:void 0;const o=a.reverseItemTable[e];return s&&o===void 0?n:o}lookupLocationName(t,e,s=!0){const n=`Unknown Location ${e}`,a=this.findPackage(t);if(!a)return s?n:void 0;const o=a.reverseLocationTable[e];return s&&o===void 0?n:o}#n(){return new F("Archipelago",{checksum:"ac9141e9ad0318df2fa27da5f20c50a842afeecb",item_name_to_id:{Nothing:-1},location_name_to_id:{"Cheat Console":-1,Server:-2}})}}class yt{#t;#e=[];#s;#i;constructor(t,e,s){this.#t=t,this.#s=e,this.#i=s}replace(t){return this.#e.push({operation:"replace",value:t}),this}default(){return this.#e.push({operation:"default",value:null}),this}add(t){return this.#e.push({operation:"add",value:t}),this}multiply(t){return this.#e.push({operation:"mul",value:t}),this}power(t){return this.#e.push({operation:"pow",value:t}),this}remainder(t){return this.#e.push({operation:"mod",value:t}),this}floor(){return this.#e.push({operation:"floor",value:null}),this}ceiling(){return this.#e.push({operation:"ceil",value:null}),this}max(t){return this.#e.push({operation:"max",value:t}),this}min(t){return this.#e.push({operation:"min",value:t}),this}and(t){return this.#e.push({operation:"and",value:t}),this}or(t){return this.#e.push({operation:"or",value:t}),this}xor(t){return this.#e.push({operation:"xor",value:t}),this}leftShift(t){return this.#e.push({operation:"left_shift",value:t}),this}rightShift(t){return this.#e.push({operation:"right_shift",value:t}),this}remove(t){return this.#e.push({operation:"remove",value:t}),this}pop(t){return this.#e.push({operation:"pop",value:t}),this}update(t){return this.#e.push({operation:"update",value:t}),this}async commit(t=!1){const e=U(),s={cmd:"Set",default:this.#i,key:this.#s,operations:this.#e,want_reply:t,uuid:e};if(this.#t.socket.send(s),!t)return;const[n]=await this.#t.socket.wait("setReply",a=>a.uuid===e);return n.value}}class wt{#t;#e={};#s={};constructor(t){this.#t=t,this.#t.socket.on("disconnected",()=>{this.#e={},this.#s={}}).on("setReply",e=>{this.#e[e.key]=e.value;const s=this.#s[e.key];s&&s.forEach(n=>n(e.key,e.value,e.original_value))}).on("connected",()=>{if(this.#t.options.debugLogVersions){const e=`${this.#t.game}:${gt}:${navigator?.userAgent}`;this.prepare("archipelago.js__runtimes",{}).default().update({[e]:!0}).commit(!1)}})}get store(){return structuredClone(this.#e)}async fetch(t,e=!1){let s=typeof t=="string"?[t]:t;if(e){const a=s.filter(o=>this.#e[o]===void 0);a.length>0&&this.#t.socket.send({cmd:"SetNotify",keys:a})}let n={};if(s=s.filter(a=>{const o=structuredClone(this.#e[a]),r=o!==void 0;return r&&(n[a]=o),!r}),s.length>0){const a=await this.#i(s);n={...n,...a}}return e&&(this.#e={...this.#e,...n}),typeof t=="string"?n[t]:n}async notify(t,e){return t.forEach(s=>{this.#s[s]??=[],this.#s[s].push(e)}),this.fetch(t,!0)}prepare(t,e){if(t.startsWith("_read_"))throw TypeError("Cannot manipulate read only keys.");return new yt(this.#t,t,e)}async fetchItemNameGroups(t){return await this.fetch([`_read_item_name_groups_${t}`],!0)}async fetchLocationNameGroups(t){return await this.fetch([`_read_location_name_groups_${t}`],!0)}async#i(t){const e=U(),[s]=await this.#t.socket.send({cmd:"Get",keys:t,uuid:e}).wait("retrieved",n=>n.uuid===e);return s.keys}}class bt{#t={};addEventListener(t,e,s=!1){this.#t[t]??=[],this.#t[t].push([e,s])}removeEventListener(t,e){const s=this.#t[t];s&&s.length>0&&(this.#t[t]=s.filter(([n])=>n!==e))}dispatchEvent(t,e){const s=this.#t[t]??[];for(const[n,a]of s)n(...e),a&&this.removeEventListener(t,n)}}class _{#t=new bt;on(t,e){return this.#t.addEventListener(t,e),this}off(t,e){return this.#t.removeEventListener(t,e),this}async wait(t,e=()=>!0){return new Promise(s=>{const n=(...a)=>{e(...a)&&(this.#t.removeEventListener(t,n),s(a))};this.#t.addEventListener(t,n)})}emit(t,e){this.#t.dispatchEvent(t,e)}}class vt extends _{#t;#e=Number.MIN_SAFE_INTEGER;constructor(t){super(),this.#t=t,this.#t.socket.on("bounced",e=>{if(e.tags?.includes("DeathLink")&&e.data.time&&e.data.source){const s=e.data;if(s.time===this.#e)return;this.#e=s.time,this.emit("deathReceived",[s.source,s.time*1e3,s.cause])}})}get enabled(){return this.#t.arguments.tags.includes("DeathLink")}enableDeathLink(){this.#t.arguments.tags.includes("DeathLink")||this.#t.updateTags([...this.#t.arguments.tags,"DeathLink"])}disableDeathLink(){this.#t.arguments.tags.includes("DeathLink")&&this.#t.updateTags(this.#t.arguments.tags.filter(t=>t!=="DeathLink"))}sendDeathLink(t,e){if(!this.#t.authenticated)throw new g("Cannot send death links before connecting and authenticating.");if(!this.enabled)return;this.#e=Math.ceil(Date.now()/1e3);const s={source:t,cause:e,time:this.#e};this.#t.bounce({tags:["DeathLink"]},s)}}class R{#t;#e;#s;constructor(t,e){this.#t=t,this.#e=e,this.#s=new p(this.#t,{item:e.item,location:e.location,player:e.finding_player,flags:e.item_flags},this.#t.players.findPlayer(e.finding_player),this.#t.players.findPlayer(e.receiving_player))}get item(){return this.#s}get found(){return this.#e.found}get entrance(){return this.#e.entrance||"Vanilla"}}class _t extends _{#t;#e=[];#s=[];constructor(t){super(),this.#t=t,this.#t.socket.on("receivedItems",e=>{let s=e.index;const n=e.items.length,a=[...e.items];for(;a.length>0;){const o=a.shift();this.#e[s++]=new p(this.#t,o,this.#t.players.findPlayer(o.player),this.#t.players.self)}this.emit("itemsReceived",[this.#e.slice(e.index,e.index+n),e.index])}).on("connected",()=>{this.#s=[],this.#e=[],this.#t.storage.notify([`_read_hints_${this.#t.players.self.team}_${this.#t.players.self.slot}`],this.#i.bind(this)).then(e=>{const s=e[`_read_hints_${this.#t.players.self.team}_${this.#t.players.self.slot}`];this.#s=s.map(n=>new R(this.#t,n)),this.emit("hintsInitialized",[this.#s])}).catch(e=>{throw e})})}get received(){return[...this.#e]}get hints(){return[...this.#s]}get count(){return this.#e.length}#i(t,e){for(let s=0;s<e.length;s++)this.#s[s]===void 0?(this.#s[s]=new R(this.#t,e[s]),this.emit("hintReceived",[this.#s[s]])):this.#s[s].found!==e[s].found&&(this.#s[s]=new R(this.#t,e[s]),this.emit("hintFound",[this.#s[s]]))}}class S{client;part;constructor(t,e){this.client=t,this.part=e}toString(){return this.text}}class kt extends S{part;type="item";item;constructor(t,e,s,n){super(t,e);const a=t.players.findPlayer(e.player,n.team);this.part=e,this.item=new p(t,s,a,n)}get text(){return this.item.name}}class Pt extends S{#t;part;type="location";id;constructor(t,e){super(t,e);const s=t.players.findPlayer(e.player),n=t.package.findPackage(s.game);this.part=e,e.type==="location_name"?(this.#t=e.text,this.id=n.locationTable[e.text]):(this.id=parseInt(e.text),this.#t=t.package.lookupLocationName(s.game,this.id,!0))}get text(){return this.#t}}class St extends S{part;type="color";color;constructor(t,e){super(t,e),this.part=e,this.color=e.color}get text(){return this.part.text}}class Ct extends S{part;type;constructor(t,e){super(t,e),this.part=e,this.part.type==="entrance_name"?this.type="entrance":this.type="text"}get text(){return this.part.text}}class At extends S{part;type="player";player;constructor(t,e){if(super(t,e),this.part=e,e.type==="player_id")this.player=t.players.findPlayer(parseInt(e.text));else{const s=t.players.teams[t.players.self.team].find(n=>n.name===e.text);if(!s)throw new Error(`Cannot find player under name: ${e.text}`);this.player=s}}get text(){return this.player.alias}}class Lt extends _{#t;#e=[];get log(){return[...this.#e]}constructor(t){super(),this.#t=t,this.#t.socket.on("printJSON",this.#s.bind(this))}async say(t){if(!this.#t.authenticated)throw new g("Cannot send chat messages without being authenticated.");t=t.trim();const e={cmd:"Say",text:t};this.#t.socket.send(e),await this.wait("chat",s=>s===t)}#s(t){const e=[];for(const n of t.data)switch(n.type){case"item_id":case"item_name":{const a=t;let o;a.type==="ItemCheat"?o=this.#t.players.findPlayer(a.receiving,a.team):o=this.#t.players.findPlayer(a.receiving),e.push(new kt(this.#t,n,a.item,o));break}case"location_id":case"location_name":{e.push(new Pt(this.#t,n));break}case"color":{e.push(new St(this.#t,n));break}case"player_id":case"player_name":{e.push(new At(this.#t,n));break}default:{e.push(new Ct(this.#t,n));break}}const s=e.map(n=>n.text).join();switch(this.#t.options.maximumMessages>=1&&(this.log.push({text:s,nodes:e}),this.log.splice(0,this.log.length-this.#t.options.maximumMessages)),t.type){case"ItemSend":{const n=this.#t.players.findPlayer(t.item.player),a=this.#t.players.findPlayer(t.receiving),o=new p(this.#t,t.item,n,a);this.emit("itemSent",[s,o,e]);break}case"ItemCheat":{const n=this.#t.players.findPlayer(t.item.player,t.team),a=this.#t.players.findPlayer(t.receiving,t.team),o=new p(this.#t,t.item,n,a);this.emit("itemCheated",[s,o,e]);break}case"Hint":{const n=this.#t.players.findPlayer(t.item.player),a=this.#t.players.findPlayer(t.receiving),o=new p(this.#t,t.item,n,a);this.emit("itemHinted",[s,o,t.found,e]);break}case"Join":{const n=this.#t.players.findPlayer(t.slot,t.team);this.emit("connected",[s,n,t.tags,e]);break}case"Part":{const n=this.#t.players.findPlayer(t.slot,t.team);this.emit("disconnected",[s,n,e]);break}case"Chat":{const n=this.#t.players.findPlayer(t.slot,t.team);this.emit("chat",[t.message,n,e]);break}case"ServerChat":{this.emit("serverChat",[t.message,e]);break}case"TagsChanged":{const n=this.#t.players.findPlayer(t.slot,t.team);this.emit("tagsUpdated",[s,n,t.tags,e]);break}case"Tutorial":{this.emit("tutorial",[s,e]);break}case"CommandResult":{this.emit("userCommand",[s,e]);break}case"AdminCommandResult":{this.emit("adminCommand",[s,e]);break}case"Goal":{const n=this.#t.players.findPlayer(t.slot,t.team);this.emit("goaled",[s,n,e]);break}case"Release":{const n=this.#t.players.findPlayer(t.slot,t.team);this.emit("released",[s,n,e]);break}case"Collect":{const n=this.#t.players.findPlayer(t.slot,t.team);this.emit("collected",[s,n,e]);break}case"Countdown":this.emit("countdown",[s,t.countdown,e])}this.emit("message",[s,e])}}class C{#t;#e;constructor(t,e){this.#t=t,this.#e=e}toString(){return this.alias}get name(){return this.#e.name}get alias(){return this.#e.alias}get game(){return this.slot===0?"Archipelago":this.#s.game}get type(){return this.slot===0?L.spectator:this.#s.type}get team(){return this.#e.team}get slot(){return this.#e.slot}get members(){return this.type!==L.group?[]:this.#t.players.teams[this.team].filter(t=>this.#s.group_members.includes(t.slot))}get groups(){return this.slot===0?[]:this.#t.players.teams[this.team].filter(t=>t.slot!==0&&this.#t.players.slots[t.slot].group_members.includes(this.slot))}async fetchStatus(){return this.type===L.group?$.goal:await this.#t.storage.fetch(`_read_client_status_${this.team}_${this.slot}`)??0}async fetchSlotData(){return await this.#t.storage.fetch(`_read_slot_data_${this.slot}`)}async fetchHints(){return(await this.#t.storage.fetch(`_read_hints_${this.team}_${this.slot}`)).map(e=>new R(this.#t,e))}get#s(){return this.#t.players.slots[this.slot]}}class Rt extends _{#t;#e=[];#s={};#i=0;#n=0;constructor(t){super(),this.#t=t,this.#t.socket.on("connected",e=>{this.#s=Object.freeze(e.slot_info),this.#e=[],this.#i=e.slot,this.#n=e.team;for(const s of e.players)this.#e[s.team]??=[{team:s.team,slot:0,name:"Archipelago",alias:"Archipelago"}],this.#e[s.team][s.slot]=s}).on("roomUpdate",e=>{if(e.players){for(const s of e.players)if(this.#e[s.team][s.slot].alias!==s.alias){const n=this.#e[s.team][s.slot].alias;this.#e[s.team][s.slot]=s,this.emit("aliasUpdated",[new C(this.#t,s),n,s.alias])}}})}get self(){if(this.#i===0)throw new Error("Cannot lookup own player object when client has never connected to a server.");return new C(this.#t,this.#e[this.#n][this.#i])}get slots(){return this.#s}get teams(){const t=[];for(let e=0;e<this.#e.length;e++){t[e]=[];for(let s=0;s<this.#e[e].length;s++)t[e].push(new C(this.#t,this.#e[e][s]))}return t}findPlayer(t,e){if(e===void 0&&(e=this.#t.players.self.team),this.#e[e])return new C(this.#t,this.#e[e][t])}}class xt extends _{#t;#e={major:-1,minor:-1,build:-1};#s={major:-1,minor:-1,build:-1};#i=[];#n=[];#d="";#l=!1;#o=0;#u=0;#r=0;#c={release:0,collect:0,remaining:0};#h=[];#a=[];#m=!1;get serverVersion(){return{...this.#e}}get generatorVersion(){return{...this.#s}}get games(){return[...this.#i]}get tags(){return[...this.#n]}get seedName(){return this.#d}get password(){return this.#l}get permissions(){return{...this.#c}}get hintPoints(){return this.#o}get hintCost(){return this.hintCostPercentage>0?Math.max(1,Math.floor(this.hintCostPercentage*this.allLocations.length*.01)):0}get hintCostPercentage(){return this.#u}get locationCheckPoints(){return this.#r}get missingLocations(){return[...this.#h].sort()}get checkedLocations(){return[...this.#a].sort()}get allLocations(){return[...this.#h,...this.#a].sort()}get race(){return this.#m}constructor(t){super(),this.#t=t,this.#t.socket.on("roomInfo",e=>{this.#e={major:e.version.major,minor:e.version.minor,build:e.version.build},this.#s={major:e.generator_version.major,minor:e.generator_version.minor,build:e.generator_version.build},this.#n=e.tags,this.#i=e.games,this.#d=e.seed_name,this.#l=e.password,this.#c=e.permissions,this.#u=e.hint_cost,this.#r=e.location_check_points}).on("connected",e=>{this.#h=e.missing_locations,this.#a=e.checked_locations,this.emit("locationsChecked",[this.checkedLocations]),this.#o=e.hint_points,this.emit("hintPointsUpdated",[0,e.hint_points])}).on("roomUpdate",e=>{if(e.hint_cost!==void 0){const[s,n]=[this.hintCost,this.hintCostPercentage];this.#u=e.hint_cost,this.emit("hintCostUpdated",[s,this.hintCost,n,this.hintCostPercentage])}if(e.hint_points!==void 0){const s=this.#o;this.#o=e.hint_points,this.emit("hintPointsUpdated",[s,this.hintPoints])}if(e.location_check_points!==void 0){const s=this.#r;this.#r=e.location_check_points,this.emit("locationCheckPointsUpdated",[s,this.locationCheckPoints])}if(e.password!==void 0&&(this.#l=e.password,this.emit("passwordUpdated",[this.password])),e.permissions!==void 0){const s=this.#c;this.#c=e.permissions,this.emit("permissionsUpdated",[s,this.permissions])}e.checked_locations!==void 0&&(this.#a=[...this.#a,...e.checked_locations],this.#h=this.missingLocations.filter(s=>!e.checked_locations?.includes(s)),this.emit("locationsChecked",[e.checked_locations]))})}}class It extends _{#t=null;#e=!1;constructor(){super()}get connected(){return this.#e}get url(){return this.#t?.url??""}send(...t){if(this.#t)return this.#t.send(JSON.stringify(t)),this.emit("sentPackets",[t]),this;throw new w("Unable to send packets to the server; not connected to a server.")}async connect(t){if(this.disconnect(),typeof t=="string"){if(!/^([a-zA-Z]+:)\/\/[A-Za-z0-9_.~\-:]+/i.test(t))try{return await this.connect(new URL(`wss://${t}`))}catch{return await this.connect(new URL(`ws://${t}`))}t=new URL(t)}if(t.port=t.port||"38281",t.protocol!=="wss:"&&t.protocol!=="ws:")throw new TypeError("Unexpected protocol. Archipelago only supports the ws:// and wss:// protocols.");try{return new Promise((e,s)=>{const n=this.#i();if(n===null)throw new w("Unable to find a suitable WebSocket API in the current runtime.");this.#t=new n(t),this.#t.onmessage=this.#s.bind(this),this.#t.onclose=()=>{this.disconnect(),s(new w("Failed to connect to Archipelago server."))},this.#t.onerror=()=>{this.disconnect(),s(new w("Failed to connect to Archipelago server."))},this.#t.onopen=()=>{this.wait("roomInfo").then(([a])=>{if(this.#e=!0,this.#t){this.#t.onclose=this.disconnect.bind(this),this.#t.onerror=this.disconnect.bind(this),e(a);return}this.disconnect(),s(new w("Failed to connect to Archipelago server."))}).catch(a=>{throw a})}})}catch(e){throw this.disconnect(),e}}disconnect(){this.connected&&(this.#e=!1,this.#t?.close(),this.#t=null,this.emit("disconnected",[]))}#s(t){const e=JSON.parse(t.data);for(const s of e){switch(s.cmd){case"ConnectionRefused":this.emit("connectionRefused",[s]);break;case"Bounced":this.emit("bounced",[s,s.data]);break;case"Connected":this.emit("connected",[s]);break;case"DataPackage":this.emit("dataPackage",[s]);break;case"InvalidPacket":this.emit("invalidPacket",[s]);break;case"LocationInfo":this.emit("locationInfo",[s]);break;case"PrintJSON":this.emit("printJSON",[s]);break;case"ReceivedItems":this.emit("receivedItems",[s]);break;case"Retrieved":this.emit("retrieved",[s]);break;case"RoomInfo":this.emit("roomInfo",[s]);break;case"RoomUpdate":this.emit("roomUpdate",[s]);break;case"SetReply":this.emit("setReply",[s]);break}this.emit("receivedPacket",[s])}}#i(){let t=null;return typeof window<"u"?t=window.WebSocket||window.MozWebSocket:typeof global<"u"?t=global.WebSocket||global.MozWebSocket:typeof self<"u"?t=self.WebSocket||self.MozWebSocket:typeof WebSocket<"u"?t=WebSocket:typeof MozWebSocket<"u"&&(t=MozWebSocket),t}}class Tt{#t=!1;#e=M;#s="";#i="";socket=new It;package=new pt(this);storage=new wt(this);room=new xt(this);players=new Rt(this);items=new _t(this);messages=new Lt(this);deathLink=new vt(this);options;get authenticated(){return this.socket.connected&&this.#t}get name(){return this.#s}get game(){return this.#i}get arguments(){return{...this.#e}}constructor(t){t?this.options={...q,...t}:this.options={...q},this.socket.on("disconnected",()=>{this.#t=!1}).on("sentPackets",e=>{for(const s of e)s.cmd==="ConnectUpdate"&&(this.#e.tags=s.tags,this.#e.items=s.items_handling)})}async login(t,e,s="",n){if(e==="")throw new dt("Provided slot name cannot be blank.","name",e);n?this.#e={...M,...n}:this.#e={...M};const a=new Set(this.arguments.tags);!s&&!a.has("HintGame")&&!a.has("Tracker")&&!a.has("TextOnly")&&a.add("TextOnly"),this.#e.tags=Array.from(a);const o={cmd:"Connect",name:e,game:s,password:this.arguments.password,slot_data:this.arguments.slotData,items_handling:this.arguments.items,uuid:this.arguments.uuid,tags:this.arguments.tags,version:{...this.arguments.version,class:"Version"}};return await this.socket.connect(t),this.options.autoFetchDataPackage&&await this.package.fetchPackage(),new Promise((r,y)=>{const u=setTimeout(()=>y(new w("Server failed to respond in time.")),this.options.timeout),m=d=>{this.#t=!0,this.#i=d.slot_info[d.slot].game,this.#s=d.slot_info[d.slot].name,this.socket.off("connected",m).off("connectionRefused",k),clearTimeout(u),r(d.slot_data)},k=d=>{this.socket.off("connected",m).off("connectionRefused",k),clearTimeout(u),y(new mt(`Connection was refused by the server. Reason(s): [${d.errors?.join(", ")}`,d.errors??[]))};this.socket.on("connected",m.bind(this)).on("connectionRefused",k.bind(this)).send(o)})}updateStatus(t){if(!this.authenticated)throw new g("Cannot update status while not connected and authenticated.");this.socket.send({cmd:"StatusUpdate",status:t})}goal(){this.updateStatus($.goal)}updateTags(t){if(!this.authenticated)throw new g("Cannot update tags while not connected and authenticated.");this.socket.send({cmd:"ConnectUpdate",tags:t,items_handling:this.arguments.items})}updateItemsHandling(t){if(!this.authenticated)throw new g("Cannot update tags while not connected and authenticated.");this.socket.send({cmd:"ConnectUpdate",tags:this.arguments.tags,items_handling:t})}check(...t){if(!this.authenticated)throw new g("Cannot check locations while not connected and authenticated.");t=t.filter(e=>this.room.missingLocations.includes(e)),this.socket.send({cmd:"LocationChecks",locations:t})}async scout(t,e=0){if(!this.authenticated)throw new g("Cannot scout locations while not connected and authenticated.");t=t.filter(n=>this.room.allLocations.includes(n));const[s]=await this.socket.send({cmd:"LocationScouts",create_as_hint:e,locations:t}).wait("locationInfo",n=>n.locations.map(a=>a.location).toSorted().join(",")===t.toSorted().join(","));return s.locations.map(n=>new p(this,n,this.players.self,this.players.findPlayer(n.player)))}bounce(t,e){if(!this.authenticated)throw new g("Cannot send bounces while not connected and authenticated.");this.socket.send({cmd:"Bounce",data:e,games:t.games??[],slots:t.slots??[],tags:t.tags??[]})}}let h;function ie(){h={url:void 0,slots:void 0,password:void 0},Mt()}function Mt(i){const t=i||new URL(window.location.href).searchParams,e=t.get("archipelago-url"),s=t.get("archipelago-slots")?.split(",")||[],n=t.get("archipelago-password");h={url:e,slots:s,password:n}}function ne(i){const t=i||new URLSearchParams;if(!h)return t;t.set("archipelago-url",h.url),t.set("archipelago-slots",h.slots.join(",")),t.set("archipelago-password",h.password)}function ae(i){h={url:i?.url??h.url,slots:i?.slots??h.slots,password:i?.password??h.password}}function oe(){return h}const Nt=new Map;function re(i,t){const e=h;if(!(!e.slots||e.slots.length===0))for(const s of e.slots)Et(e.url,s,e.password,t)}async function Et(i,t,e,s){const n=new Tt;try{s&&s(n,t),await n.login(i,t,void 0,{password:e||""}),Nt.set(t,n)}catch(a){console.error(a)}}function $t(i,t){if(i==null)return!0;if(typeof i=="object"){if(JSON.stringify(i)===JSON.stringify(t))return!0}else if(i===t)return!0;return!1}function A(i,t,e,s){$t(e,s)||i.set(t,String(e))}let c,l;const Ut={"system-ui":"System UI","-apple-system":"Apple System",BlinkMacSystemFont:"BlinkMac System Font",SegoeUI:"Segoe UI",Roboto:"Roboto",HelveticaNeue:"Helvetica Neue",Arial:"Arial",NotoSans:"Noto Sans",LiberationSans:"Liberation Sans",Georgia:"Georgia",TimesNewRoman:"Times New Roman",Times:"Times",PalatinoLinotype:"Palatino Linotype",BookAntiqua:"Book Antiqua",Consolas:"Consolas",Menlo:"Menlo",Monaco:"Monaco",CourierNew:"Courier New",LiberationMono:"Liberation Mono","sans-serif":"Sans-serif",serif:"Serif",monospace:"Monospace"},jt={normal:"Normal",bold:"Bold",italic:"Italic",bi:"Bold + Italic"},Dt={normal:"None",small:"Small",medium:"Medium",large:"Large"};function ce(){c={family:"Arial",size:"12",style:"normal",shadow:"normal"},l={family:void 0,size:void 0,style:void 0,shadow:void 0},Ot()}function Ot(i){const t=i||new URL(window.location.href).searchParams,e=t.get("font-family"),s=t.get("font-size"),n=t.get("font-style"),a=t.get("font-shadow");l={family:e??c.family,size:s??c.size,style:n??c.style,shadow:a??c.shadow},console.log("FONT",l)}function he(i){const t=i||new URLSearchParams;return A(t,"font-family",l.family,c.family),A(t,"font-size",l.size,c.size),A(t,"font-style",l.style,c.style),A(t,"font-shadow",l.shadow,c.shadow),t}function le(i){const t=zt();l={family:i.family??t.family,size:i.size??t.size,style:i.style??t.style,shadow:i.shadow??t.shadow}}function zt(){return{family:l?.family??c.family,size:l?.size??c.size,style:l?.style??c.style,shadow:l?.shadow??c.shadow}}function ue(){return Ut}function de(){return jt}function me(){return Dt}export{P as A,Ot as B,Vt as C,Wt as D,ot as E,Zt as G,Kt as I,T as S,ce as a,Jt as b,Gt as c,qt as d,Yt as e,re as f,H as g,Qt as h,Xt as i,se as j,ue as k,ie as l,de as m,me as n,oe as o,zt as p,le as q,ee as r,ae as s,Ft as t,Ht as u,Bt as v,ne as w,he as x,te as y,Mt as z};
